<aside class="sidebar" [class.sidebar-collapsed]="isCollapsed" aria-label="Main navigation">
  <div class="sidebar-header">
    <div class="sidebar-header-row">
      <div class="sidebar-brand" [class.sidebar-brand-collapsed]="isCollapsed">Taskboard</div>
      <button type="button" class="sidebar-toggle" (click)="toggleSidebar()" [attr.aria-label]="isCollapsed ? 'Expand sidebar' : 'Collapse sidebar'">
        <span class="sidebar-toggle-icon">{{ isCollapsed ? '▶' : '◀' }}</span>
      </button>
    </div>
    <ng-container *ngIf="themeService.currentTheme$ | async as currentTheme">
      <button
        type="button"
        class="sidebar-theme-toggle sidebar-theme-toggle-header"
        (click)="themeService.toggleTheme()"
        [attr.aria-label]="(currentTheme === 'dark' ? 'Switch to light mode' : 'Switch to dark mode')"
        [title]="currentTheme === 'dark' ? 'Light mode' : 'Dark mode'"
      >
        <span class="sidebar-theme-icon" *ngIf="currentTheme === 'dark'" aria-hidden="true">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
        </span>
        <span class="sidebar-theme-icon" *ngIf="currentTheme === 'light'" aria-hidden="true">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
        </span>
      </button>
    </ng-container>
  </div>

  <nav class="sidebar-nav">
    <a routerLink="/dashboard" routerLinkActive="sidebar-link-active" [routerLinkActiveOptions]="{ exact: true }" class="sidebar-link" [title]="isCollapsed ? 'Dashboard' : ''">
      <span class="sidebar-icon" aria-hidden="true">&#9632;</span>
      <span class="sidebar-link-text">Dashboard</span>
    </a>
    <ng-container *ngIf="user$ | async as user">
      <a *ngIf="canViewAuditLogs(user)" routerLink="/audit" routerLinkActive="sidebar-link-active" class="sidebar-link" [title]="isCollapsed ? 'Audit Logs' : ''">
        <span class="sidebar-icon" aria-hidden="true">&#128203;</span>
        <span class="sidebar-link-text">Audit Logs</span>
      </a>
    </ng-container>
  </nav>

  <ng-container *ngIf="user$ | async as user">
    <div class="sidebar-user">
      <div class="sidebar-avatar">{{ getInitials(user) }}</div>
      <div class="sidebar-user-info" *ngIf="!isCollapsed">
        <span class="sidebar-user-name" [title]="getDisplayName(user)">{{ getDisplayName(user) }}</span>
        <span class="sidebar-user-role" [title]="getRoleLabel(user)">{{ getRoleLabel(user) }}</span>
      </div>
      <div class="sidebar-actions">
        <button type="button" class="sidebar-signout" (click)="signOut()" [title]="isCollapsed ? 'Sign out' : ''">
          <span *ngIf="!isCollapsed">Sign out</span>
          <span *ngIf="isCollapsed" class="sidebar-signout-icon">↪</span>
        </button>
      </div>
    </div>
  </ng-container>
</aside>
